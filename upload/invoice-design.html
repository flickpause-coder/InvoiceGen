<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Design - InvoiceGen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .form-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.25);
            box-shadow: 0 18px 40px -24px rgba(15, 23, 42, 0.3);
        }
        .template-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .template-card:hover {
            border-color: rgba(59, 130, 246, 0.35);
            transform: translateY(-4px);
            box-shadow: 0 15px 35px -20px rgba(59, 130, 246, 0.4);
        }
        .template-card.selected {
            border-color: #2563eb;
            background: rgba(59, 130, 246, 0.08);
        }
        .color-picker {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            border: 3px solid transparent;
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        .color-picker:hover {
            transform: translateY(-3px) scale(1.02);
        }
        .color-picker.selected {
            border-color: rgba(15, 23, 42, 0.25);
        }
        .invoice-preview {
            background: linear-gradient(180deg, rgba(148, 163, 184, 0.1) 0%, rgba(255, 255, 255, 0.6) 100%);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
            min-height: 420px;
        }
    </style>
</head>
<body>
    <div data-page-content class="space-y-10">
        <section class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
            <div>
                <h1 class="text-3xl font-semibold text-slate-900">Invoice Design Studio</h1>
                <p class="text-slate-500 mt-2">Customize the look and feel of your invoices</p>
            </div>
            <div class="flex flex-wrap gap-3">
                <button onclick="saveDesign()" class="px-5 py-3 rounded-xl bg-blue-600 text-white font-medium hover:bg-blue-700 transition">
                    <i class="fas fa-save mr-2"></i>Save Design
                </button>
                <button onclick="applyToInvoices()" class="px-5 py-3 rounded-xl border border-slate-200 text-slate-700 hover:text-slate-900 hover:border-slate-300 transition">
                    <i class="fas fa-check mr-2"></i>Apply Globally
                </button>
                <button onclick="exportDesign()" class="px-5 py-3 rounded-xl border border-slate-200 text-slate-700 hover:text-slate-900 hover:border-slate-300 transition">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
        </section>

        <section class="grid gap-8 lg:grid-cols-3">
            <div class="lg:col-span-2 space-y-8">
                <div class="form-section p-6">
                    <h2 class="text-lg font-semibold text-slate-900 mb-6">Choose Template</h2>
                    <div class="grid gap-6 md:grid-cols-2">
                        <div class="template-card bg-white rounded-2xl p-5 selected" onclick="selectTemplate('professional')">
                            <div class="h-32 rounded-xl bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100 flex items-center justify-center mb-5">
                                <i class="fas fa-file-alt text-3xl text-blue-600"></i>
                            </div>
                            <h3 class="font-semibold text-slate-900">Professional</h3>
                            <p class="text-sm text-slate-500 mt-2">Clean and modern design suitable for any business.</p>
                        </div>
                        <div class="template-card bg-white rounded-2xl p-5" onclick="selectTemplate('creative')">
                            <div class="h-32 rounded-xl bg-gradient-to-br from-rose-100 via-pink-100 to-amber-100 flex items-center justify-center mb-5">
                                <i class="fas fa-palette text-3xl text-rose-500"></i>
                            </div>
                            <h3 class="font-semibold text-slate-900">Creative</h3>
                            <p class="text-sm text-slate-500 mt-2">Vibrant styling for agencies and creative brands.</p>
                        </div>
                        <div class="template-card bg-white rounded-2xl p-5" onclick="selectTemplate('minimal')">
                            <div class="h-32 rounded-xl bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center mb-5">
                                <i class="fas fa-minus text-3xl text-slate-500"></i>
                            </div>
                            <h3 class="font-semibold text-slate-900">Minimal</h3>
                            <p class="text-sm text-slate-500 mt-2">Elegant design focused on clarity and whitespace.</p>
                        </div>
                        <div class="template-card bg-white rounded-2xl p-5" onclick="selectTemplate('corporate')">
                            <div class="h-32 rounded-xl bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center mb-5">
                                <i class="fas fa-building text-3xl text-emerald-500"></i>
                            </div>
                            <h3 class="font-semibold text-slate-900">Corporate</h3>
                            <p class="text-sm text-slate-500 mt-2">Structured layout for enterprise reporting.</p>
                        </div>
                    </div>
                </div>

                <div class="form-section p-6">
                    <h2 class="text-lg font-semibold text-slate-900 mb-6">Brand Palette</h2>
                    <div class="grid gap-4 md:grid-cols-2">
                        <div>
                            <h3 class="text-sm font-semibold text-slate-600 mb-3">Primary Colors</h3>
                            <div class="grid grid-cols-4 gap-4">
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-blue-500 selected mx-auto" onclick="selectColor('blue')" id="color-blue"></div>
                                    <p class="text-xs text-slate-500">Blue</p>
                                </div>
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-purple-500 mx-auto" onclick="selectColor('purple')" id="color-purple"></div>
                                    <p class="text-xs text-slate-500">Purple</p>
                                </div>
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-emerald-500 mx-auto" onclick="selectColor('green')" id="color-green"></div>
                                    <p class="text-xs text-slate-500">Green</p>
                                </div>
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-rose-500 mx-auto" onclick="selectColor('red')" id="color-red"></div>
                                    <p class="text-xs text-slate-500">Rose</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-sm font-semibold text-slate-600 mb-3">Secondary Colors</h3>
                            <div class="grid grid-cols-4 gap-4">
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-orange-500 mx-auto" onclick="selectColor('orange')" id="color-orange"></div>
                                    <p class="text-xs text-slate-500">Orange</p>
                                </div>
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-teal-500 mx-auto" onclick="selectColor('teal')" id="color-teal"></div>
                                    <p class="text-xs text-slate-500">Teal</p>
                                </div>
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-indigo-500 mx-auto" onclick="selectColor('indigo')" id="color-indigo"></div>
                                    <p class="text-xs text-slate-500">Indigo</p>
                                </div>
                                <div class="text-center space-y-2">
                                    <div class="color-picker bg-slate-500 mx-auto" onclick="selectColor('gray')" id="color-gray"></div>
                                    <p class="text-xs text-slate-500">Slate</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section p-6">
                    <h2 class="text-lg font-semibold text-slate-900 mb-6">Typography</h2>
                    <div class="grid gap-4 md:grid-cols-3">
                        <label class="space-y-2 text-sm">
                            <span class="text-slate-500">Heading Font</span>
                            <select id="heading-font" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-blue-200" onchange="generatePreview()">
                                <option value="serif">Serif (Traditional)</option>
                                <option value="sans" selected>Sans-serif (Modern)</option>
                                <option value="mono">Monospace (Technical)</option>
                            </select>
                        </label>
                        <label class="space-y-2 text-sm">
                            <span class="text-slate-500">Body Font</span>
                            <select id="body-font" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-blue-200" onchange="generatePreview()">
                                <option value="serif">Serif (Traditional)</option>
                                <option value="sans" selected>Sans-serif (Modern)</option>
                                <option value="mono">Monospace (Technical)</option>
                            </select>
                        </label>
                        <label class="space-y-2 text-sm">
                            <span class="text-slate-500">Font Size</span>
                            <select id="font-size" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-blue-200" onchange="generatePreview()">
                                <option value="small">Small (Compact)</option>
                                <option value="medium" selected>Medium (Standard)</option>
                                <option value="large">Large (Accessible)</option>
                            </select>
                        </label>
                    </div>
                </div>

                <div class="form-section p-6">
                    <h2 class="text-lg font-semibold text-slate-900 mb-6">Company Information</h2>
                    <div class="grid gap-4 md:grid-cols-2">
                        <label class="space-y-2 text-sm md:col-span-2">
                            <span class="text-slate-500">Company Name</span>
                            <input type="text" id="company-name" value="Your Company Name" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-blue-200" oninput="generatePreview()">
                        </label>
                        <div class="space-y-2 text-sm">
                            <span class="text-slate-500">Logo</span>
                            <div class="border-2 border-dashed border-slate-300 rounded-xl p-5 text-center space-y-3">
                                <i class="fas fa-cloud-upload-alt text-2xl text-slate-400"></i>
                                <p class="text-sm text-slate-500">Upload your logo</p>
                                <input type="file" id="logo-upload" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                                <button onclick="document.getElementById('logo-upload').click()" class="px-4 py-2 rounded-lg bg-slate-900 text-white text-sm hover:bg-slate-700">Choose File</button>
                            </div>
                        </div>
                        <label class="space-y-2 text-sm">
                            <span class="text-slate-500">Accent Style</span>
                            <select id="accent-style" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-blue-200" onchange="generatePreview()">
                                <option value="gradient">Gradient</option>
                                <option value="solid" selected>Solid</option>
                                <option value="outline">Outline</option>
                            </select>
                        </label>
                        <label class="space-y-2 text-sm md:col-span-2">
                            <span class="text-slate-500">Address</span>
                            <textarea id="company-address" rows="3" class="w-full px-3 py-2 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-blue-200" placeholder="123 Business Street&#10;City, State 12345&#10;Country" oninput="generatePreview()"></textarea>
                        </label>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1 space-y-6">
                <div class="form-section p-6 sticky top-24">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-slate-900">Live Preview</h2>
                        <button onclick="resetDesign()" class="text-sm text-slate-500 hover:text-slate-900">Reset</button>
                    </div>
                    <div id="invoice-preview" class="invoice-preview p-6 mt-6 overflow-hidden"></div>
                    <div class="mt-6 space-y-3">
                        <button onclick="saveDesign()" class="w-full px-4 py-3 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition">Save Design</button>
                        <button onclick="applyToInvoices()" class="w-full px-4 py-3 rounded-lg border border-slate-200 text-slate-700 hover:text-slate-900 hover:border-slate-300 transition">Apply to All Invoices</button>
                        <button onclick="exportDesign()" class="w-full px-4 py-3 rounded-lg border border-slate-200 text-slate-700 hover:text-slate-900 hover:border-slate-300 transition">Export Theme</button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        window.APP_SHELL_CONFIG = {
            active: 'invoice-design',
            headerEyebrow: 'Branding',
            headerTitle: 'Invoice Design',
            headerSubtitle: 'Craft stunning invoice templates that match your brand identity in minutes.'
        };
    </script>
    <script src="app-shell.js" defer></script>
    <script src="auth-improved.js"></script>
    <script>
        let selectedTemplate = 'professional';
        let selectedColor = 'blue';
        let currentDesign = {};

        function selectTemplate(template) {
            selectedTemplate = template;
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
            const selectedCard = document.querySelector(`.template-card[onclick*="${template}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            generatePreview();
        }

        function selectColor(color) {
            selectedColor = color;
            document.querySelectorAll('.color-picker').forEach(colorEl => colorEl.classList.remove('selected'));
            const selectedColorEl = document.getElementById(`color-${color}`);
            if (selectedColorEl) {
                selectedColorEl.classList.add('selected');
            }
            generatePreview();
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                currentDesign.logo = e.target.result;
                generatePreview();
            };
            reader.readAsDataURL(file);
        }

        function saveDesign() {
            currentDesign = {
                template: selectedTemplate,
                color: selectedColor,
                headingFont: document.getElementById('heading-font').value,
                bodyFont: document.getElementById('body-font').value,
                fontSize: document.getElementById('font-size').value,
                companyName: document.getElementById('company-name').value,
                companyAddress: document.getElementById('company-address').value,
                accentStyle: document.getElementById('accent-style').value,
                logo: currentDesign.logo || null
            };

            localStorage.setItem('invoiceDesign', JSON.stringify(currentDesign));
            alert('Design saved successfully!');
        }

        function applyToInvoices() {
            saveDesign();
            alert('Design applied to all invoices. Future invoices will use this style.');
        }

        function exportDesign() {
            saveDesign();
            const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(currentDesign, null, 2));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute('href', dataStr);
            downloadAnchor.setAttribute('download', 'invoice-design.json');
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            downloadAnchor.remove();
        }

        function resetDesign() {
            localStorage.removeItem('invoiceDesign');
            selectedTemplate = 'professional';
            selectedColor = 'blue';
            currentDesign = {};
            document.getElementById('heading-font').value = 'sans';
            document.getElementById('body-font').value = 'sans';
            document.getElementById('font-size').value = 'medium';
            document.getElementById('company-name').value = 'Your Company Name';
            document.getElementById('company-address').value = '';
            document.getElementById('accent-style').value = 'solid';
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
            document.querySelector('.template-card').classList.add('selected');
            document.querySelectorAll('.color-picker').forEach(colorEl => colorEl.classList.remove('selected'));
            document.getElementById('color-blue').classList.add('selected');
            generatePreview();
        }

        function generatePreview() {
            const preview = document.getElementById('invoice-preview');
            if (!preview) return;

            const colors = {
                blue: '#2563eb',
                purple: '#7c3aed',
                green: '#10b981',
                red: '#ef4444',
                orange: '#f97316',
                teal: '#14b8a6',
                indigo: '#6366f1',
                gray: '#475569'
            };

            const accent = colors[selectedColor] || colors.blue;
            const headingFont = document.getElementById('heading-font').value;
            const bodyFont = document.getElementById('body-font').value;
            const fontSize = document.getElementById('font-size').value;
            const companyName = document.getElementById('company-name').value;
            const companyAddress = document.getElementById('company-address').value;
            const accentStyle = document.getElementById('accent-style').value;

            const fontScale = {
                small: 'text-xs',
                medium: 'text-sm',
                large: 'text-base'
            };

            const fontClass = fontScale[fontSize] || 'text-sm';

            preview.innerHTML = `
                <div class="space-y-6 ${fontClass}" style="font-family: ${bodyFont === 'sans' ? 'Inter, sans-serif' : bodyFont === 'serif' ? '"Cormorant Garamond", serif' : '"JetBrains Mono", monospace'};">
                    <header class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-semibold" style="font-family: ${headingFont === 'sans' ? 'Inter, sans-serif' : headingFont === 'serif' ? '"Cormorant Garamond", serif' : '"JetBrains Mono", monospace'}; color: ${accent};">Invoice</h1>
                            <p class="text-slate-500">#INV-2048</p>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-semibold text-slate-900">${companyName}</p>
                            <p class="text-slate-500 text-xs whitespace-pre-line">${companyAddress || '123 Business Street\nCity, State 12345\nCountry'}</p>
                        </div>
                    </header>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs uppercase tracking-wide text-slate-400">Bill to</p>
                            <p class="text-slate-900 font-medium mt-1">Acme Corporation</p>
                            <p class="text-slate-500 text-xs">billing@acme.com</p>
                        </div>
                        <div>
                            <p class="text-xs uppercase tracking-wide text-slate-400">Due Date</p>
                            <p class="text-slate-900 font-medium mt-1">Oct 14, 2024</p>
                            <p class="text-slate-500 text-xs">Net 15 terms</p>
                        </div>
                    </div>
                    <table class="w-full text-left text-xs border border-slate-200 rounded-lg overflow-hidden">
                        <thead style="background:${accentStyle === 'gradient' ? `linear-gradient(135deg, ${accent}, ${accent}cc)` : accent};" class="text-white">
                            <tr>
                                <th class="px-4 py-2">Description</th>
                                <th class="px-4 py-2">Qty</th>
                                <th class="px-4 py-2">Rate</th>
                                <th class="px-4 py-2 text-right">Amount</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white text-slate-600">
                            <tr>
                                <td class="px-4 py-2">UX/UI Design Sprint</td>
                                <td class="px-4 py-2">1</td>
                                <td class="px-4 py-2">$3,200.00</td>
                                <td class="px-4 py-2 text-right">$3,200.00</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="px-4 py-2">Product Strategy Workshop</td>
                                <td class="px-4 py-2">1</td>
                                <td class="px-4 py-2">$1,800.00</td>
                                <td class="px-4 py-2 text-right">$1,800.00</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2">Support & QA</td>
                                <td class="px-4 py-2">10</td>
                                <td class="px-4 py-2">$85.00</td>
                                <td class="px-4 py-2 text-right">$850.00</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="flex items-end justify-between">
                        <div class="text-xs text-slate-500">
                            <p>Payment is due within 15 days. Late payments are subject to a 1.5% monthly fee.</p>
                        </div>
                        <div class="w-48 space-y-2 text-xs">
                            <div class="flex items-center justify-between">
                                <span class="text-slate-500">Subtotal</span>
                                <span class="text-slate-900 font-medium">$5,850.00</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-slate-500">Tax (8%)</span>
                                <span class="text-slate-900 font-medium">$468.00</span>
                            </div>
                            <div class="flex items-center justify-between text-sm font-semibold" style="color: ${accent};">
                                <span>Total Due</span>
                                <span>$6,318.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedDesign = JSON.parse(localStorage.getItem('invoiceDesign') || 'null');
            if (savedDesign) {
                selectedTemplate = savedDesign.template || 'professional';
                selectedColor = savedDesign.color || 'blue';
                document.getElementById('heading-font').value = savedDesign.headingFont || 'sans';
                document.getElementById('body-font').value = savedDesign.bodyFont || 'sans';
                document.getElementById('font-size').value = savedDesign.fontSize || 'medium';
                document.getElementById('company-name').value = savedDesign.companyName || 'Your Company Name';
                document.getElementById('company-address').value = savedDesign.companyAddress || '';
                document.getElementById('accent-style').value = savedDesign.accentStyle || 'solid';
                currentDesign = savedDesign;
            }
            selectTemplate(selectedTemplate);
            selectColor(selectedColor);
            generatePreview();
        });
    </script>
</body>
</html>
